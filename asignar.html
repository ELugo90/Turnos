<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Asignar Turno</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "TU_APIKEY",
  authDomain: "turnos-evento.firebaseapp.com",
  databaseURL: "https://turnos-evento-default-rtdb.firebaseio.com",
  projectId: "turnos-evento",
  storageBucket: "turnos-evento.firebasestorage.app",
  messagingSenderId: "108395086341",
  appId: "1:108395086341:web:db50986497b6deb278126c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.asignarTurno = async function(){

  const snapshot = await get(child(ref(db), "turnos"));
  let numero = 1;

  if(snapshot.exists()){
    numero = Object.keys(snapshot.val()).length + 1;
  }

  await push(ref(db,"turnos"),{
    numero: numero,
    estado: "pendiente",
    horaAsignado: new Date().toLocaleString()
  });

  document.getElementById("numero").innerHTML = numero;
  document.getElementById("qr").src =
  "https://api.qrserver.com/v1/create-qr-code/?size=250x250&data="+numero;
}
</script>

<style>
body{
  font-family:Arial;
  text-align:center;
  background:#0a192f;
  color:white;
  margin:0;
}

.logo{
  width:180px;
  margin:20px auto;
  display:block;
}

button{
  padding:15px 30px;
  font-size:20px;
  margin-top:20px;
}

#numero{
  font-size:70px;
  margin-top:20px;
}

img#qr{
  margin-top:20px;
}
</style>
</head>
<body>

<img src="logo.png" class="logo">

<h1>Asignar Turno</h1>

<button onclick="asignarTurno()">Generar Turno</button>

<div id="numero"></div>
<img id="qr"/>

</body>
</html>
